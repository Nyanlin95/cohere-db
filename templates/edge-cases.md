# Edge Cases Handling Guide

> AUTO-GENERATED by cohere. Core patterns work for all agents.

## 1. Session Restart Amnesia

### Universal Pattern
Fresh agents lose context between sessions. Use external checkpoints for persistence.

```typescript
// Universal checkpoint pattern - works for all agents
interface AgentCheckpoint {
  timestamp: string;
  sessionId: string;
  schemaVersion: string;
  currentTask?: TaskContext;
  discoveredPatterns: DiscoveredPattern[];
}
```

> [!NOTE|CLAUDE]
> Claude Code: Use `~/.Claude/CLAUDE.md` for user-level memory. Project-specific memory goes in `.ai/memory/`.
>
> **Hook available**: `claude mem` command for quick memory operations

> [!NOTE|CODEX]
> **CRITICAL**: Codex 0.27+ does NOT auto-load AGENTS.md. You MUST explicitly tell Codex to read it at session start:
> ```
> Read the AGENTS.md file in this directory for context.
> ```
> Without this, AGENTS.md content is ignored.

> [!NOTE|ANTIGRAVITY]
> Antigravity: Use checkpoint files in `.ai/memory/checkpoints/` for parallel agent coordination

> [!NOTE|XCODE]
> Xcode 26.3: Use `ProjectDescription.plist` for persistent context. Index-time context doesn't persist across sessions.

---

## 2. Tool Misalignment

### Universal Pattern
Schema misunderstandings cause wrong API calls. Validate types before queries.

```sql
-- Universal validation query
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'target_table';
```

> [!NOTE|CODEX]
> Codex + Float→Enum: Explicit casting required. Codex may assume float when enum expected:
> ```sql
> -- Use explicit casting
> SELECT status::order_status_enum FROM orders WHERE id = $1;
> ```

> [!NOTE|ANTIGRAVITY]
> Antigravity MCP + SQL Hallucinations: Always prefix queries with schema validation:
> ```
> First verify: What columns exist in orders table?
> Then query: SELECT ...
> ```

---

## 3. Infinite Context Exploration

### Universal Limits
| Operation | Limit | Reason |
|-----------|-------|--------|
| SELECT rows | 10,000 max | Prevent context exhaustion |
| JOIN depth | 5 max | Query complexity |
| Query timeout | 30s | Resource sharing |

### Universal Pagination Pattern
```typescript
// Keyset pagination - works everywhere
async function paginateWithKeyset(
  table: string, 
  lastId: string | null, 
  limit: number = 100
): Promise<QueryResult> {
  if (lastId) {
    return query(`SELECT * FROM ${table} WHERE id > $1 ORDER BY id LIMIT $2`, [lastId, limit]);
  }
  return query(`SELECT * FROM ${table} ORDER BY id LIMIT $2`, [limit]);
}
```

> [!NOTE|CLAUDE]
> Claude Code: Built-in rate limiting. Use `claude --verbose` to see token usage.

> [!NOTE|CODEX]
> Codex: Context window fills fast. Keep AGENTS.md under 4000 tokens. Use `session:include` sparingly.

> [!NOTE|ANTIGRAVITY]
> Antigravity: Parallel agents share context budget. Coordinate via `.ai/memory/checkpoints/`.

---

## 4. Verification Gaps

### Universal Test Pattern
```typescript
interface EdgeCaseTest {
  name: string;
  input: unknown;
  expectedOutput: unknown;
  rarity: 'common' | 'rare' | 'edge';
}
```

> [!NOTE|ALL]
> All agents: Test edge cases before deployment. Common gaps:
> - Empty result sets
> - Duplicate PK attempts
> - Soft-deleted records inclusion
> - Orphaned foreign keys

---

## 5. Memory Management

### Universal Memory Path
```
.ai/
├── memory/
│   ├── checkpoints/          # Session checkpoints
│   │   └── checkpoint-{timestamp}.json
│   ├── accumulated-learnings.md  # Cross-session knowledge
│   └── session-history.md    # Recent sessions
```

> [!WARNING|ALL]
> **ALL AGENTS**: Never rely on in-session context for critical state. Save checkpoints every 5-10 minutes.

---

## Platform-Specific Pitfalls Summary

| Agent | Key Pitfall | Mitigation |
|-------|-------------|------------|
| Claude | Session drift | Use `~/.Claude/CLAUDE.md` + hooks |
| Codex | No auto-load AGENTS.md | Explicitly prompt to read |
| Antigravity | Parallel desync | Checkpoint coordination |
| Xcode | Index-only context | Use .xcworkspace persistent |

---

## Debug Commands

```bash
# Claude: Check memory
claude mem list

# Codex: Verify context
codex context --stats

# Universal: Schema validation
db-ai validate --schema
```
