# Database Context

> AUTO-GENERATED by cohere. Works with Claude, Codex, Antigravity, Xcode.

> [!NOTE|CLAUDE]
> **Claude Code**: This file auto-loads. Use with `claude` commands.
>
> ```bash
> claude db:validate  # Verify queries against schema
> claude test:run      # Run edge case tests
> ```

> [!NOTE|CODEX]
> **Codex**: You MUST explicitly read this file at session start:
> ```
> Read the CLAUDE.md file in this directory for database context.
> ```
> Codex does NOT auto-load context files.

> [!NOTE|ANTIGRAVITY]
> **Antigravity**: Use with MCP. Coordinate schema context via `.ai/memory/`.

> [!NOTE|XCODE]
> **Xcode 26.3**: Use Swift package context. Link to this file in extension config.

---

## Overview

**Database:** {{databaseType}}
**Schema:** {{schemaName}}
**Tables:** {{tables.length}}

## Tables

{{#each tables}}
### {{name}}

{{#if description}}
> {{description}}
{{/if}}

| Column | Type | Nullable | Key | Notes |
|--------|------|----------|-----|-------|
{{#each columns}}
| `{{name}}` | `{{type}}` | {{#if nullable}}yes{{else}}no{{/if}} | {{#if isKey}}PK/FK{{else}}-{{/if}} | {{#if description}}{{description}}{{else}}-{{/if}} |
{{/each}}

{{#if indexes}}
**Indexes:**
{{#each indexes}}
- `{{name}}` on `({{columns}})`{{#if unique}} (unique){{/if}}
{{/each}}
{{/if}}

{{#if foreignKeys}}
**Foreign Keys:**
{{#each foreignKeys}}
- `{{column}}` â†’ `{{referencesTable}}.{{referencesColumn}}`
{{/each}}
{{/if}}
{{/each}}

---

## Relationships

{{#each relationships}}
- `{{fromTable}}` {{cardinality}} `{{toTable}}`{{#if onDelete}} (ON DELETE {{onDelete}}){{/if}}
{{/each}}

> [!NOTE|ALL]
> **ALL AGENTS**: Foreign key columns MUST be indexed for query performance.

---

## Business Rules

{{#each businessRules}}
### {{name}}

{{description}}

**Rule:**
```sql
{{rule}}
```
{{#if examples}}

**Examples:**
{{#each examples}}
```sql
{{this}}
```
{{/each}}
{{/if}}
{{/each}}

---

## Common Queries

See [`.ai/queries/`](.ai/queries/) for:

- CRUD operations per table
- Join patterns
- Aggregate queries
- Edge case handling

---

## Conventions

{{#each conventions}}
- {{.}}
{{/each}}

> [!NOTE|ALL]
> **ALL AGENTS**: Parameterized queries required. Never interpolate strings directly into SQL.

---

## Multi-Tenant Isolation

{{#if ownershipRules}}
{{ownershipRules}}
{{else}}
- All tables include `organization_id` for tenant separation
- Verify ownership before writes
{{/if}}

> [!WARNING|CODEX]
> **CODEX USERS**: Add this to your AGENTS.md:
> ```
> All queries MUST include organization_id filter.
> Pattern: SELECT ... WHERE id = $1 AND organization_id = $2
> ```

> [!WARNING|ANTIGRAVITY]
> **ANTIGRAVITY**: Parallel agents share tenant context. Coordinate via checkpoints.

---

## Validation

```bash
# Universal validation
cohere-db validate --schema

# Claude-specific
claude db:check

# Codex-specific
codex exec "cohere-db validate --schema"
```

---

## Troubleshooting

| Error | Solution |
|-------|----------|
| Connection refused | Verify DATABASE_URL |
| Relation not found | Check relationships above |
| Permission denied | Ensure SELECT access |

---

## Additional Resources

| Resource | Purpose |
|----------|----------|
| `.ai/edge-cases.md` | Edge case patterns |
| `.ai/constraints.md` | Query limits |
| `.ai/test-templates/` | Edge case tests |
| `.ai/memory/` | Checkpoint patterns |
